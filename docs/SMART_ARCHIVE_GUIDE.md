# 智能归档功能使用指南

## 📚 功能概述

智能归档是小智小智知识库管理系统的核心功能之一，它使用AI技术自动分析文档内容，并将文档智能归档到合适的知识库中。如果没有匹配的知识库，系统会自动创建新的知识库。

## 🎯 主要特性

- **🤖 AI智能分析**：基于文档内容和用户提示词进行智能分类
- **📋 两阶段处理**：先分析预览，用户确认后再实际归档（2024年最新功能）
- **📁 自动归档**：自动匹配现有知识库或创建新知识库
- **🔤 多文档支持**：支持批量上传和处理
- **🎨 预设模板**：提供多种预设的文档类型提示词
- **💾 实时反馈**：提供详细的处理进度和归档结果
- **🔍 预览确认**：归档前可预览AI分析结果和文档内容

## 🚀 使用方法

### 1. 启动智能归档

在知识库管理页面的"全部文档"视图中，点击 **"智能归档"** 按钮，打开智能归档对话框。

### 2. 选择文档

- **拖拽上传**：将文件拖拽到上传区域
- **点击选择**：点击上传区域选择文件
- **批量上传**：支持同时选择多个文件

支持的文件格式：
- PDF文档（.pdf）
- 图像文件（.png, .jpg, .jpeg）
- 文本文件（.txt）
- Word文档（.doc, .docx）

### 3. 配置智能分析

#### 启用智能分析
切换"启用智能分析"开关来控制是否使用AI分析功能。

#### 选择预设提示词
系统提供了多种预设的文档类型提示词：

| 图标 | 类型 | 描述 |
|------|------|------|
| 📄 | 合同文档 | 合同、协议、法律文件等 |
| 🎓 | 教育培训 | 课程资料、培训手册、学习指南等 |
| 💼 | 商务文档 | 商业计划、市场分析、财务报告等 |
| ⚙️ | 技术文档 | 技术规范、API文档、开发指南等 |
| 📖 | 操作手册 | 用户手册、操作指南、流程文档等 |
| ❤️ | 医疗健康 | 医学资料、健康指南、医疗报告等 |
| 🛡️ | 政策法规 | 政府政策、法律法规、规章制度等 |
| ⚡ | 自定义分析 | 根据内容自动判断文档类型 |

#### 自定义提示词
您可以编写自定义的分析提示词，例如：
```
这是技术开发相关的文档，包含API接口文档、系统设计方案、代码规范等。请分析文档内容，判断具体的技术分类，并归档到相应的技术文档知识库中。
```

### 4. 执行智能分析（阶段一）

点击 **"智能分析"** 按钮开始处理。系统会：

1. **内容提取**：提取文档的文本内容（PDF OCR、图像识别等）
2. **AI分析**：使用提示词分析文档内容和类型
3. **知识库匹配**：查找匹配的现有知识库
4. **预览展示**：显示分析结果供用户确认

### 5. 确认归档建议（阶段二）

分析完成后，系统会展示每个文档的分析结果：

- **📄 文档名称**：显示原始文件名
- **🏷️ 文档类型**：AI识别的文档类型（合同、技术文档等）
- **📂 建议归档至**：推荐的目标知识库名称
- **🆕 知识库状态**：新建或使用现有知识库
- **💡 分析原因**：AI给出的归档理由
- **📝 文档预览**：显示文档内容摘要

用户可以：
- **📋 审查建议**：仔细查看每个文档的归档建议
- **🔄 重新分析**：如果不满意可以修改提示词重新分析
- **✅ 确认归档**：点击"确认归档"执行实际保存操作

### 6. 执行实际归档

确认后系统会：
1. **创建知识库**：为新建的知识库分配颜色和描述
2. **文档处理**：将文档内容进行向量化处理
3. **建立关联**：将文档关联到指定的知识库
4. **完成反馈**：显示最终的归档结果

### 7. 查看处理结果

每个文档的处理过程会显示：
- 🧠 **AI分析中**：正在分析文档内容（阶段一）
- 📋 **等待确认**：分析完成，等待用户确认（阶段一完成）
- 📂 **归档中**：执行实际归档操作（阶段二）
- ✅ **归档完成**：文档已成功归档到知识库（阶段二完成）

## 📊 归档逻辑

### 知识库匹配规则

系统会按以下顺序进行知识库匹配：

1. **关键词匹配**：在文档内容、文件名和提示词中查找关键词
2. **现有知识库**：优先匹配已存在的知识库
3. **创建新库**：如果没有匹配的知识库，自动创建新的

### 预设知识库类型

| 知识库名称 | 匹配关键词 | 文档类型 |
|------------|------------|----------|
| 合同文档 | 合同、contract、协议、agreement | 法律文件 |
| 教育培训 | 培训、教育、课程、training、education | 学习资料 |
| 技术文档 | 技术、开发、api、technical、development | 技术资料 |
| 商务文档 | 商务、商业、市场、business、commercial | 商业资料 |
| 操作手册 | 手册、指南、manual、guide、操作 | 操作指导 |
| 医疗健康 | 医疗、健康、医学、medical、health | 医疗资料 |
| 政策法规 | 政策、法规、法律、policy、regulation | 政策文件 |

### 新知识库创建

如果文档不匹配任何现有知识库，系统会：
1. 分析文档类型（报告、计划、规范、笔记、总结等）
2. 创建对应的新知识库（如"报告文档"、"计划文档"等）
3. 为新知识库分配随机颜色
4. 自动生成合适的描述信息

## 🎨 界面功能

### 上传进度显示
- **整体进度条**：显示所有文件的整体处理进度
- **单文件状态**：每个文件的详细处理状态
- **错误提示**：处理失败时的详细错误信息

### 归档结果摘要
- **归档统计**：成功归档的文档数量
- **新建知识库**：显示新创建的知识库数量
- **详细信息**：每个文档的归档位置和原因

## ⚠️ 注意事项

### 文件限制
- **大小限制**：单个文件不超过配置的最大大小
- **数量限制**：批量上传最多20个文件
- **格式限制**：仅支持指定的文件格式

### 性能建议
- **小批量处理**：建议每次处理5-10个文件以获得最佳性能
- **网络环境**：确保网络连接稳定，大文件处理需要较长时间
- **文档质量**：清晰的文档内容有助于提高分析准确性

### 最佳实践
1. **明确的提示词**：使用具体、详细的分析提示词
2. **一致的命名**：使用有意义的文件名
3. **定期整理**：定期检查和整理知识库结构
4. **测试验证**：对重要文档先进行小规模测试

## 🔧 技术实现

### 前端组件
- `SmartArchiveDialog.vue`：智能归档对话框
- `KnowledgeBaseView.vue`：知识库管理主界面

### 后端API
- `POST /api/lm/rag/analyze-documents`：文档分析接口（阶段一）
- `POST /api/lm/rag/confirm-smart-archive`：确认归档接口（阶段二）
- `POST /api/lm/rag/smart-archive`：单文档智能归档（一步到位）
- `POST /api/lm/rag/batch-smart-archive`：批量智能归档（一步到位）

### 核心服务
- `RAGService.analyze_document_for_archive()`：文档分析服务（不保存）
- `RAGService.confirm_archive_document()`：确认归档服务（实际保存）
- `RAGService.smart_archive_document()`：智能归档核心逻辑（一步到位）
- `_analyze_document_content()`：文档内容分析
- `_extract_text_from_file()`：文档文本提取

## 📈 扩展功能

### 未来计划
- **LLM集成**：集成更强大的大语言模型进行分析
- **自定义规则**：支持用户自定义归档规则
- **历史记录**：归档操作的历史记录和统计
- **批量管理**：批量移动和重新归档功能

### 自定义配置
系统支持通过配置文件调整：
- 相似度阈值
- 分块大小
- 处理超时时间
- 支持的文件类型

## 💡 使用技巧

1. **提示词优化**：根据实际需求调整提示词内容
2. **分类策略**：建立清晰的文档分类策略
3. **定期维护**：定期检查归档结果的准确性
4. **权限管理**：为不同用户设置适当的知识库访问权限

## 🆘 常见问题

**Q: 智能归档失败怎么办？**
A: 检查网络连接，确认文件格式和大小符合要求，如果问题持续存在，可以使用普通上传模式。

**Q: 如何提高归档准确性？**
A: 使用清晰、具体的提示词，确保文档内容质量，选择合适的预设模板。

**Q: 能否修改已归档的文档位置？**
A: 可以在知识库管理界面中手动移动文档到其他知识库。

**Q: 支持哪些语言的文档？**
A: 主要支持中文和英文文档，其他语言的支持程度取决于OCR和分析模型的能力。

---

*更多信息请参考项目文档或联系技术支持团队。*